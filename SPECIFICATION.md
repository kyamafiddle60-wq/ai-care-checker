# AI Ready Checker - 介護施設版 システム仕様書

## 1. システム概要

### 1.1 プロジェクト名
**AI Ready Checker - 介護施設版**

### 1.2 目的
介護施設のAI導入準備度を診断するWebアプリケーション。30問の質問に回答することで、施設のAI導入準備度を5分で診断し、詳細なレポートと改善提案を提供する。

### 1.3 主要機能
- **無料診断**: 30問の質問によるAI導入準備度診断
- **診断結果表示**: 総合スコア、カテゴリー別スコア、レーダーチャート表示
- **改善提案**: スコアが低いカテゴリーに対する具体的な改善提案
- **料金プラン表示**: 無料プラン、スタンダード、プレミアムの3プラン

### 1.4 技術スタック
- **フレームワーク**: Streamlit 1.52.0以上
- **可視化ライブラリ**: Plotly 6.0.0以上
- **言語**: Python 3.14
- **開発環境**: macOS (darwin 25.1.0)

---

## 2. システムアーキテクチャ

### 2.1 アーキテクチャ概要
本システムは、Streamlitベースのシングルページアプリケーション（SPA）として実装されており、以下の3層構造を持つ：

```
┌─────────────────────────────────────┐
│   Presentation Layer (Streamlit)    │
│   - app.py                          │
│   - pages/1_診断開始.py              │
│   - pages/2_診断結果.py              │
│   - pages/3_料金プラン.py            │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│   Business Logic Layer              │
│   - modules/scoring.py              │
│   - modules/questions.py            │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│   Data Layer                        │
│   - st.session_state (メモリ内)      │
└─────────────────────────────────────┘
```

### 2.2 ファイル構成
```
ai-care-checker/
├── app.py                    # メインアプリケーション（ホーム、ナビゲーション）
├── pages/
│   ├── 1_診断開始.py         # 診断質問ページ
│   ├── 2_診断結果.py         # 診断結果表示ページ
│   └── 3_料金プラン.py       # 料金プラン表示ページ
├── modules/
│   ├── questions.py          # 質問データ定義
│   └── scoring.py            # スコアリングロジック
├── requirements.txt          # 依存パッケージ
├── README.md                 # セットアップ・起動方法
└── SPECIFICATION.md          # 本仕様書
```

---

## 3. データ構造

### 3.1 質問データ構造 (`modules/questions.py`)

#### 3.1.1 QUESTIONS辞書
```python
QUESTIONS = {
    "category_key": [
        {
            "id": "question_id",           # 質問ID（例: "b1", "d2"）
            "text": "質問文",               # 質問テキスト
            "choices": [                    # 選択肢リスト
                {
                    "text": "選択肢テキスト",
                    "score": 0-20           # スコア（0, 5, 10, 15, 20のいずれか）
                },
                ...
            ]
        },
        ...
    ],
    ...
}
```

#### 3.1.2 カテゴリー定義
- **business** (ビジネス準備度): 5問
- **data** (データ準備度): 5問
- **organization** (組織準備度): 5問
- **technology** (技術準備度): 5問
- **process** (プロセス準備度): 5問
- **compliance** (コンプライアンス準備度): 5問

**合計**: 6カテゴリー × 5問 = 30問

#### 3.1.3 質問ID命名規則
- カテゴリーの頭文字 + 連番
  - business → b1, b2, b3, b4, b5
  - data → d1, d2, d3, d4, d5
  - organization → o1, o2, o3, o4, o5
  - technology → t1, t2, t3, t4, t5
  - process → p1, p2, p3, p4, p5
  - compliance → c1, c2, c3, c4, c5

### 3.2 セッション状態 (`st.session_state`)

#### 3.2.1 回答データ
```python
st.session_state.answers = {
    "question_id": choice_index,  # 選択肢のインデックス（0始まり）
    # 例: {"b1": 2, "b2": 1, "d1": 0, ...}
}
```

#### 3.2.2 ラジオボタン状態
```python
st.session_state["radio_{question_id}"] = selected_index  # プレースホルダーを含むインデックス（0始まり）
# 例: st.session_state["radio_b1"] = 3  # プレースホルダー(0) + 選択肢(1-5) = 1-5の値
```

#### 3.2.3 メニュー状態
```python
st.session_state['menu'] = "ホーム" | "無料診断" | "診断結果" | "料金プラン"
```

#### 3.2.4 初期化フラグ
```python
st.session_state.diagnosis_initialized = True  # 診断ページの初期化済みフラグ
```

### 3.3 スコアリングデータ構造 (`modules/scoring.py`)

#### 3.3.1 業界平均値
```python
INDUSTRY_AVERAGES = {
    "business": 65,
    "data": 55,
    "organization": 60,
    "technology": 50,
    "process": 58,
    "compliance": 70
}
```

#### 3.3.2 準備度ランク定義
```python
READINESS_RANKS = {
    "A": {"min": 541, "max": 600, "label": "優秀"},
    "B": {"min": 481, "max": 540, "label": "良好"},
    "C": {"min": 421, "max": 480, "label": "要改善"},
    "D": {"min": 360, "max": 420, "label": "大幅改善必要"},
    "E": {"min": 0, "max": 359, "label": "導入困難"}
}
```

#### 3.3.3 スコア計算結果
```python
{
    "category_scores": {
        "business": 85,
        "data": 70,
        "organization": 60,
        "technology": 50,
        "process": 58,
        "compliance": 70
    },
    "total_score": 393,      # 合計スコア
    "max_score": 600,        # 最大スコア（全問満点の場合）
    "percentage": 65.5       # 達成率（%）
}
```

---

## 4. ページ仕様

### 4.1 メインページ (`app.py`)

#### 4.1.1 ページ設定
- **ページタイトル**: "AI Ready Checker - 介護施設版"
- **ページアイコン**: 🏥
- **レイアウト**: wide
- **サイドバー**: expanded（初期状態で展開）

#### 4.1.2 サイドバーメニュー
- **タイトル**: "🏥 AI Ready Checker"
- **メニュー項目**:
  1. ホーム
  2. 無料診断
  3. 診断結果
  4. 料金プラン

#### 4.1.3 ホームページコンテンツ
1. **タイトル**: "🏥 AI Ready Checker - 介護施設版"
2. **サブタイトル**: "5分で分かる、あなたの施設のAI導入準備度"
3. **ツールの説明**: AI Ready Checkerの概要説明
4. **主な特徴**:
   - 無料診断30問
   - カスタマイズレポート
   - ROI試算
   - 補助金ガイド
5. **開発者プロフィール**: 山本喜一郎 (71歳) のプロフィール
6. **無料診断を始めるボタン**: 診断ページへの遷移

#### 4.1.4 ナビゲーションロジック
- **無料診断**: `st.switch_page("pages/1_診断開始.py")` で遷移
- **診断結果**: 
  - 回答データがある場合: `st.switch_page("pages/2_診断結果.py")` で遷移
  - 回答データがない場合: 警告メッセージと「診断を開始する」ボタンを表示
- **料金プラン**: `st.switch_page("pages/3_料金プラン.py")` で遷移

### 4.2 診断開始ページ (`pages/1_診断開始.py`)

#### 4.2.1 ページ設定
- **ページタイトル**: "AI導入診断"
- **ページアイコン**: 🏥
- **レイアウト**: wide

#### 4.2.2 UI要素

**1. タイトル・説明**
- タイトル: "🏥 AI導入準備度診断（30問）"
- 説明: "各質問について、もっとも当てはまる選択肢を選んでください。"

**2. 診断をやり直すボタン**
- 条件: `st.session_state.answers` に回答がある場合のみ表示
- 機能: 
  - `st.session_state.answers` をクリア
  - `radio_` で始まるキーをすべて削除
  - `st.rerun()` でページを再読み込み

**3. 固定進捗バー（Sticky Progress Bar）**
- **位置**: 画面上部に固定表示（`position: fixed`）
- **表示内容**:
  - プログレスバー（回答済み数 / 全質問数）
  - テキスト: "回答済み: X/30問"
- **CSS実装**:
  - `.progress-sticky-wrapper` クラスで固定
  - `z-index: 999` で最前面に表示
  - メインコンテンツに `padding-top: 80px` を追加して重なりを防止

**4. 質問表示**
- **カテゴリー別にグループ化**して表示
- 各カテゴリーの見出し: "📊 {カテゴリー名}"
- **質問形式**: `st.radio` を使用
- **選択肢**:
  - インデックス0: "選択してください"（プレースホルダー）
  - インデックス1-5: 実際の選択肢（質問によって3-5個）
- **未回答の視覚的区別**:
  - CSSで半透明表示（`opacity: 0.5`）
  - グレースケールフィルター（`filter: grayscale(40%)`）
  - `<div data-question-id="{question_id}">` でラップ

**5. 回答保存ロジック**
- **コールバック関数**: `on_change` パラメータで指定
- **保存条件**: 選択されたインデックスが0より大きい場合のみ保存
- **保存形式**: `st.session_state.answers[question_id] = choice_index - 1`（プレースホルダー分を補正）

**6. 完了メッセージ**
- **全問回答済み**: 
  - 成功メッセージ: "✅ 全ての質問に回答しました！"
  - 「📊 診断結果を見る」ボタンを表示
  - ボタンクリックで `st.switch_page("pages/2_診断結果.py")` に遷移
- **未回答あり**: 
  - 情報メッセージ: "💡 残り **X問** です。全ての質問に回答してください。"

#### 4.2.3 セッション状態管理
- **初期化**: `diagnosis_initialized` フラグで初回のみラジオボタン状態をクリア
- **回答保存**: `on_change` コールバックで即座に保存
- **状態クリア**: 「診断をやり直す」ボタンで全状態をクリア

### 4.3 診断結果ページ (`pages/2_診断結果.py`)

#### 4.3.1 ページ設定
- **ページタイトル**: "診断結果"
- **ページアイコン**: 📊
- **レイアウト**: wide

#### 4.3.2 セッションチェック
- **条件**: `st.session_state.answers` が存在し、長さが0より大きいこと
- **エラー処理**: 回答がない場合は警告メッセージと「診断を開始する」ボタンを表示

#### 4.3.3 UI要素

**1. タイトル**
- "📊 AI導入準備度診断結果"

**2. 総合スコア表示（3列）**
- **総合スコア**: "{total_score}/{max_score}点"
- **達成率**: "{percentage}%"
- **準備度ランク**: 
  - ランク（A-E）とラベル（優秀、良好、要改善、大幅改善必要、導入困難）
  - ランクに応じた色分け:
    - A: 成功（緑）
    - B: 情報（青）
    - C: 警告（黄）
    - D/E: エラー（赤）

**3. レーダーチャート**
- **ライブラリ**: Plotly (`plotly.graph_objects`)
- **表示内容**:
  - あなたの施設のスコア（実線、青色）
  - 業界平均（破線、オレンジ色、半透明）
- **軸**: 6カテゴリー（ビジネス、データ、組織、技術、プロセス、コンプライアンス）
- **範囲**: 0から各カテゴリーの最大スコアまで

**4. カテゴリー別詳細スコア**
- **表示形式**: カード形式
- **各カテゴリーに表示**:
  - カテゴリー名
  - スコア: "{score}/{max_score}点"
  - 達成率: "({percentage}%)"
  - 業界平均との比較:
    - プラス: 成功メッセージ（緑）
    - マイナス: エラーメッセージ（赤）
    - 同等: 情報メッセージ（青）
  - プログレスバー

**5. 改善優先度 TOP3**
- **ソート**: スコアが低い順
- **各優先度に表示**:
  - 順位とカテゴリー名
  - 現在スコアと達成率
  - 業界平均との差分（マイナスの場合）
  - 改善提案（カテゴリー別の具体的な提案文）

**6. 次のステップ**
- **無料プラン**: 基本機能の説明
- **有料プラン**: 追加機能の説明

**7. アクションボタン（3列）**
- **🔄 診断をやり直す**: 
  - `st.session_state.answers` をクリア
  - `radio_` で始まるキーをすべて削除
  - `st.switch_page("pages/1_診断開始.py")` に遷移
- **💰 料金プランを見る**: 
  - `st.switch_page("pages/3_料金プラン.py")` に遷移
- **📧 お問い合わせ**: 
  - 情報メッセージ: "お問い合わせフォームは準備中です。"

#### 4.3.4 エラーハンドリング
- **スコア計算エラー**: 
  - エラーメッセージとトレースバックを表示
  - `st.stop()` で処理を停止

### 4.4 料金プランページ (`pages/3_料金プラン.py`)

#### 4.4.1 ページ設定
- **ページタイトル**: "料金プラン"
- **ページアイコン**: 💰
- **レイアウト**: wide

#### 4.4.2 UI要素

**1. タイトル・説明**
- タイトル: "💰 料金プラン"
- サブタイトル: "あなたの施設に最適なプランをお選びください"

**2. 3つのプランカード（3列）**

**無料プラン**
- **価格**: ¥0
- **説明**: 基本的な診断機能
- **機能**:
  - ✅ 基本診断（30問）
  - ✅ 診断結果表示
  - ✅ レーダーチャート
- **スタイル**: 青色のボーダー、背景色 `rgba(31, 119, 180, 0.05)`

**スタンダード**
- **価格**: ¥9,800/月
- **説明**: 詳細レポート・ROI試算
- **機能**:
  - ✅ 基本診断（30問）
  - ✅ 詳細レポート
  - ✅ ROI試算
  - ✅ 補助金ガイド
- **スタイル**: オレンジ色のボーダー、背景色 `rgba(255, 152, 0, 0.05)`

**プレミアム**
- **価格**: ¥29,800/月
- **説明**: 全機能 + サポート
- **機能**:
  - ✅ 基本診断（30問）
  - ✅ 詳細レポート
  - ✅ ROI試算
  - ✅ 補助金ガイド
  - ✅ 専任サポート
  - ✅ カスタムコンサル
- **スタイル**: 赤色のボーダー、背景色 `rgba(244, 67, 54, 0.05)`

**3. プラン詳細比較テーブル**
- **形式**: Markdownテーブル
- **列**: 機能、無料プラン、スタンダード、プレミアム
- **機能リスト**:
  - 基本診断（30問）
  - 診断結果表示
  - レーダーチャート
  - 詳細レポート
  - ROI試算
  - 補助金ガイド
  - 専任サポート
  - カスタムコンサル

**4. お問い合わせセクション**
- **説明文**: プランの詳細や導入に関する質問の案内
- **ボタン**: "📧 お問い合わせフォーム"
- **動作**: クリックで情報メッセージ "お問い合わせフォームは準備中です。" を表示

---

## 5. モジュール仕様

### 5.1 質問データモジュール (`modules/questions.py`)

#### 5.1.1 定数
- **QUESTIONS**: 全質問データの辞書
- **CATEGORIES**: カテゴリー名の辞書
- **CATEGORY_DESCRIPTIONS**: カテゴリー説明の辞書

#### 5.1.2 関数

**`get_total_questions() -> int`**
- **説明**: 全質問数を返す
- **戻り値**: 質問数（30）

**`get_questions_by_category(category: str) -> list`**
- **説明**: 指定されたカテゴリーの質問リストを返す
- **引数**: 
  - `category`: カテゴリーキー（"business", "data", ...）
- **戻り値**: 質問オブジェクトのリスト

**`get_question_by_id(question_id: str) -> dict | None`**
- **説明**: 質問IDから質問データを取得する
- **引数**: 
  - `question_id`: 質問ID（例: "b1", "d2"）
- **戻り値**: 質問オブジェクト、見つからない場合は `None`

### 5.2 スコアリングモジュール (`modules/scoring.py`)

#### 5.2.1 定数
- **INDUSTRY_AVERAGES**: 業界平均値の辞書
- **READINESS_RANKS**: 準備度ランクの定義辞書

#### 5.2.2 関数

**`calculate_scores(answers: dict) -> dict`**
- **説明**: 診断結果からスコアを計算
- **引数**: 
  - `answers`: 質問IDをキー、選択肢インデックスを値とする辞書
- **戻り値**: 
  ```python
  {
      "category_scores": {...},  # カテゴリー別スコア
      "total_score": int,        # 総合スコア
      "max_score": int,          # 最大スコア
      "percentage": float         # 達成率（%）
  }
  ```

**`get_readiness_rank(total_score: int) -> str`**
- **説明**: 準備度ランクを判定
- **引数**: 
  - `total_score`: 総合スコア
- **戻り値**: ランク文字列（"A", "B", "C", "D", "E"）

**`get_readiness_rank_label(rank: str) -> str`**
- **説明**: ランクのラベルを取得
- **引数**: 
  - `rank`: ランク文字列
- **戻り値**: ランクラベル（"優秀", "良好", ...）

**`compare_with_average(category_scores: dict) -> dict`**
- **説明**: 業界平均値との比較
- **引数**: 
  - `category_scores`: カテゴリー別スコア
- **戻り値**: 業界平均との差分の辞書

**`get_improvement_priorities(category_scores: dict) -> list`**
- **説明**: スコアが低い順に改善優先度を返す
- **引数**: 
  - `category_scores`: カテゴリー別スコア
- **戻り値**: `[("category", score), ...]` の形式のリスト（スコアが低い順）

**`get_category_max_score(category: str) -> int`**
- **説明**: カテゴリーの最大スコアを取得
- **引数**: 
  - `category`: カテゴリー名
- **戻り値**: 最大スコア

**`get_category_percentage(category_score: int, category: str) -> float`**
- **説明**: カテゴリーのスコアをパーセンテージで取得
- **引数**: 
  - `category_score`: カテゴリースコア
  - `category`: カテゴリー名
- **戻り値**: パーセンテージ（小数点第1位まで）

**`get_score_summary(answers: dict) -> dict`**
- **説明**: スコアのサマリー情報を取得
- **引数**: 
  - `answers`: 診断結果の回答
- **戻り値**: 
  ```python
  {
      "scores": {...},              # calculate_scores()の結果
      "rank": str,                  # ランク
      "rank_label": str,            # ランクラベル
      "comparison": {...},          # 業界平均との比較
      "priorities": [...],          # 改善優先度リスト
      "category_percentages": {...} # カテゴリー別達成率
  }
  ```

---

## 6. UI/UX仕様

### 6.1 デザイン原則
- **シンプルで直感的なUI**: Streamlitの標準コンポーネントを活用
- **視覚的フィードバック**: 未回答質問の半透明表示、進捗バー、色分け
- **レスポンシブデザイン**: `layout="wide"` で広い画面に対応

### 6.2 カラースキーム
- **成功**: 緑色（ランクA、業界平均より高い）
- **情報**: 青色（ランクB、無料プラン）
- **警告**: 黄色（ランクC）
- **エラー**: 赤色（ランクD/E、業界平均より低い、プレミアムプラン）
- **オレンジ**: スタンダードプラン

### 6.3 インタラクション
- **ラジオボタン**: 即座に回答を保存（`on_change`コールバック）
- **進捗バー**: リアルタイムで更新
- **ページ遷移**: `st.switch_page()` を使用

### 6.4 アクセシビリティ
- **明確なラベル**: すべてのUI要素に適切なラベル
- **視覚的区別**: 未回答質問の半透明表示
- **エラーメッセージ**: 明確で理解しやすいメッセージ

---

## 7. セッション管理

### 7.1 セッション状態の初期化
- **初回アクセス**: `st.session_state` は空
- **診断ページ初回**: `diagnosis_initialized` フラグでラジオボタン状態をクリア

### 7.2 セッション状態の保存
- **回答データ**: `st.session_state.answers` に辞書形式で保存
- **ラジオボタン状態**: `st.session_state["radio_{question_id}"]` に保存
- **メニュー状態**: `st.session_state['menu']` に保存

### 7.3 セッション状態のクリア
- **診断をやり直す**: 
  - `st.session_state.answers = {}`
  - `radio_` で始まるキーをすべて削除
- **ページ遷移**: セッション状態は保持される

### 7.4 セッション状態の永続化
- **現在**: メモリ内のみ（ブラウザを閉じると消える）
- **将来の拡張**: データベースやファイルへの保存を検討可能

---

## 8. エラーハンドリング

### 8.1 入力検証
- **回答データの型チェック**: 整数であることを確認
- **選択肢インデックスの範囲チェック**: 有効範囲内か確認

### 8.2 エラー表示
- **診断未完了**: 警告メッセージと「診断を開始する」ボタン
- **スコア計算エラー**: エラーメッセージとトレースバック表示

### 8.3 エラー回復
- **診断未完了**: 診断ページへの遷移を促す
- **スコア計算エラー**: `st.stop()` で処理を停止

---

## 9. パフォーマンス

### 9.1 読み込み時間
- **初回読み込み**: Streamlitの標準的な読み込み時間
- **ページ遷移**: `st.switch_page()` による即座の遷移

### 9.2 メモリ使用量
- **質問データ**: メモリ内に保持（約30KB）
- **セッション状態**: ユーザーごとに独立

### 9.3 スコア計算
- **計算時間**: O(n)（nは質問数、30問）
- **最適化**: 必要に応じてキャッシュを検討可能

---

## 10. セキュリティ

### 10.1 データ保護
- **個人情報**: 現在は収集していない
- **セッション状態**: メモリ内のみ、外部に送信しない

### 10.2 入力検証
- **選択肢インデックス**: 有効範囲内かチェック
- **質問ID**: 存在する質問IDかチェック

### 10.3 将来の拡張
- **認証**: ユーザー認証機能の追加を検討可能
- **データ暗号化**: 機密データの暗号化を検討可能

---

## 11. テスト仕様

### 11.1 単体テスト（将来実装）
- **スコア計算**: 各関数の動作確認
- **質問データ**: データ構造の整合性確認

### 11.2 統合テスト（将来実装）
- **ページ遷移**: 各ページ間の遷移確認
- **セッション状態**: 状態の保持とクリア確認

### 11.3 手動テスト項目
- **診断フロー**: 30問すべてに回答して結果を確認
- **診断をやり直す**: 状態が正しくクリアされるか確認
- **ページ遷移**: すべての遷移パスを確認

---

## 12. 将来の拡張計画

### 12.1 機能拡張
- **ユーザー認証**: ログイン機能
- **診断履歴**: 過去の診断結果の保存と比較
- **詳細レポート**: PDFエクスポート機能
- **ROI試算**: 具体的な数値計算機能
- **補助金ガイド**: データベース連携

### 12.2 技術的改善
- **データベース**: 回答データの永続化
- **API**: RESTful APIの提供
- **モバイル対応**: レスポンシブデザインの改善

### 12.3 UI/UX改善
- **アニメーション**: スムーズな遷移効果
- **ダークモード**: テーマ切り替え機能
- **多言語対応**: 英語版の追加

---

## 13. 依存関係

### 13.1 必須パッケージ
```
streamlit>=1.52.0
plotly>=6.0.0
```

### 13.2 Pythonバージョン
- **推奨**: Python 3.14
- **最小**: Python 3.8以上

### 13.3 システム要件
- **OS**: macOS, Linux, Windows
- **メモリ**: 512MB以上
- **ディスク**: 100MB以上

---

## 14. 開発者情報

### 14.1 開発者
- **名前**: 山本喜一郎
- **年齢**: 71歳
- **経験**: C言語・アセンブラ歴40年、AI学習1年

### 14.2 プロジェクト情報
- **リポジトリ**: GitHub（バックアップ済み）
- **ライセンス**: 未指定（要検討）

---

## 15. 変更履歴

### Version 1.0.0（現在）
- 初回リリース
- 基本診断機能の実装
- 診断結果表示機能の実装
- 料金プラン表示機能の実装

---

## 16. 参考資料

### 16.1 Streamlitドキュメント
- https://docs.streamlit.io/

### 16.2 Plotlyドキュメント
- https://plotly.com/python/

### 16.3 プロジェクトファイル
- `README.md`: セットアップ・起動方法
- `requirements.txt`: 依存パッケージ一覧

---

**最終更新日**: 2025年1月
**バージョン**: 1.0.0

